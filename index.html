<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¯¶è—çµäºº - è¸©åœ°é›·å¤§æŒ‘æˆ°</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        text-align: center;
        background-color: #f0f2f5;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
      }
      h1 {
        color: #333;
        margin-bottom: 10px;
      }
      #score-board {
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 20px;
      }

      /* éŠæˆ²å€åŸŸ */
      #game-grid {
        display: grid;
        grid-template-columns: repeat(5, 60px);
        gap: 10px;
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .box {
        width: 60px;
        height: 60px;
        /* é€™è£¡æŠŠåŸæœ¬çš„ background-image æ‹¿æ‰ï¼Œæ”¹ç”± JS æ§åˆ¶ */
        background-color: #eee; /* é è¨­åº•è‰²ï¼Œåœ–ç‰‡è¼‰å…¥å‰é¡¯ç¤º */
        background-size: cover;
        background-position: center;
        border-radius: 8px;
        cursor: pointer;
        font-size: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.1s;
        user-select: none;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
      }

      .box:active {
        transform: scale(0.95);
      }
      .box.revealed {
        cursor: default;
        pointer-events: none;
        background-image: none !important; /* é‡è¦ï¼å¼·åˆ¶ç§»é™¤èƒŒæ™¯åœ– */
        background-color: #fff; /* é»é–‹å¾Œçš„åº•è‰² */
        box-shadow: none;
      }
      .box.good {
        background-color: #2ecc71;
        color: white;
      }
      .box.bad {
        background-color: #e74c3c;
        animation: shake 0.5s;
      }

      /* çµç®—å½ˆçª— */
      #modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        width: 300px;
      }
      input {
        padding: 10px;
        width: 80%;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      button {
        padding: 10px 20px;
        background: #333;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background: #555;
      }
      .loading {
        color: #888;
        font-size: 0.9em;
        display: none;
      }

      @keyframes shake {
        0% {
          transform: translate(1px, 1px) rotate(0deg);
        }
        10% {
          transform: translate(-1px, -2px) rotate(-1deg);
        }
        20% {
          transform: translate(-3px, 0px) rotate(1deg);
        }
        30% {
          transform: translate(3px, 2px) rotate(0deg);
        }
        100% {
          transform: translate(0, 0) rotate(0);
        }
      }
    </style>
  </head>
  <body>
    <h1>å¯¶è—çµäºº ğŸ’</h1>
    <div id="score-board">åˆ†æ•¸: 0</div>

    <div id="game-grid"></div>

    <div id="modal">
      <div class="modal-content">
        <h2 id="end-title">ğŸ’¥ çˆ†ç‚¸äº†ï¼</h2>
        <p>æœ€çµ‚åˆ†æ•¸: <span id="final-score">0</span></p>
        <input
          type="text"
          id="player-name"
          placeholder="è¼¸å…¥ä½ çš„åå­—"
          maxlength="10"
        />
        <br />
        <button onclick="submitScore()">ä¸Šå‚³åˆ†æ•¸ä¸¦é‡ä¾†</button>
        <p class="loading" id="loading-msg">ä¸Šå‚³ä¸­...</p>
      </div>
    </div>

    <script>
      // è¨­å®šå€ï¼šè«‹å¡«å…¥ä½ çš„ Google Apps Script ç¶²å€
      const API_URL = "https://script.google.com/macros/s/AKfycbx8EG2kN-I28uHcuKZl-UGP9oDEaDf_zejQEW4_m8WxsEtXwJbpWq6SSRHiORuVXVaffg/exec";

      const gridSize = 25; // 5x5
      let score = 0;
      let isGameOver = false;
      let bombIndex = -1;
      const gridEl = document.getElementById("game-grid");
      const scoreEl = document.getElementById("score-board");
      const modalEl = document.getElementById("modal");
      const finalScoreEl = document.getElementById("final-score");

      // åˆå§‹åŒ–éŠæˆ²
      const foodImages = [
          "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=300", // æ²™æ‹‰/å¥åº·é¤
          "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=300", // æ¼¢å ¡
          "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=300", // å£½å¸
          "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=300", // æ¯”è–©
          "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=300", // çƒ¤è‚‰/ç‰›æ’
          "https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=300", // æ‹‰éºµ
          "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=300", // ç‚¸é›
          "https://images.unsplash.com/photo-1563729784474-d77dbb933a9e?w=300", // è›‹ç³•
          "https://images.unsplash.com/photo-1482049016688-2d3e1b311543?w=300", // æ—©é¤ç›¤
          "https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?w=300", // æ²™æ‹‰/è¼•é£Ÿ
          "https://images.unsplash.com/photo-1567620905732-2d1ec7ab7445?w=300", // é¬†é¤…
          "https://images.unsplash.com/photo-1585032226651-759b368d7246?w=300"  // é»å¿ƒ
      ];
      
      function initGame() {
          gridEl.innerHTML = '';
          score = 0;
          isGameOver = false;
          scoreEl.innerText = `åˆ†æ•¸: ${score}`;
          modalEl.style.display = 'none';
          document.getElementById('loading-msg').style.display = 'none';
      
          // éš¨æ©Ÿæ±ºå®šç‚¸å½ˆä½ç½®
          bombIndex = Math.floor(Math.random() * gridSize);
      
          for (let i = 0; i < gridSize; i++) {
              let box = document.createElement('div');
              box.className = 'box';
              box.dataset.index = i;
              
              // --- æ–°å¢é€™æ®µï¼šéš¨æ©ŸæŒ‘é¸ä¸€å¼µåœ–ç‰‡ ---
              // éš¨æ©Ÿé¸ä¸€å€‹ç´¢å¼•å€¼
              const randomImgIndex = Math.floor(Math.random() * foodImages.length);
              // è¨­å®šèƒŒæ™¯åœ–ç‰‡
              box.style.backgroundImage = `url('${foodImages[randomImgIndex]}')`;
              // -------------------------------
      
              box.addEventListener('click', () => handleClick(box, i));
              gridEl.appendChild(box);
          }
      }

      // é»æ“Šè™•ç†
      function handleClick(box, index) {
        if (isGameOver || box.classList.contains("revealed")) return;

        box.classList.add("revealed");

        if (index === bombIndex) {
          // è¸©åˆ°ç‚¸å½ˆ
          box.classList.add("bad");
          box.innerText = "ğŸ’£";
          gameOver();
        } else {
          // è¸©åˆ°å¯¶è—
          box.classList.add("good");
          box.innerText = "ğŸ’";
          score += 10;
          scoreEl.innerText = `åˆ†æ•¸: ${score}`;
        }
      }

      function gameOver() {
        isGameOver = true;
        // é¡¯ç¤ºæ‰€æœ‰ç­”æ¡ˆ
        const boxes = document.querySelectorAll(".box");
        boxes[bombIndex].classList.add("bad");
        boxes[bombIndex].innerText = "ğŸ’£";

        setTimeout(() => {
          finalScoreEl.innerText = score;
          modalEl.style.display = "flex";
        }, 500);
      }

      // ä¸Šå‚³åˆ†æ•¸
      function submitScore() {
        const name = document.getElementById("player-name").value || "ç„¡åæ°";
        const loadingMsg = document.getElementById("loading-msg");

        loadingMsg.style.display = "block";

        // ä½¿ç”¨ fetch ç™¼é€ POST è«‹æ±‚
        // mode: 'no-cors' æ˜¯ç‚ºäº†é¿å…è·¨åŸŸéŒ¯èª¤ï¼Œé›–ç„¶é€™æ¨£å‰ç«¯ç„¡æ³•è®€å–å›å‚³å€¼ï¼Œ
        // ä½†è³‡æ–™ç¢ºå¯¦æœƒé€åˆ° Google Sheet
        fetch(API_URL, {
          method: "POST",
          mode: "no-cors",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ name: name, score: score }),
        })
          .then(() => {
            alert("åˆ†æ•¸å·²ä¸Šå‚³ï¼");
            initGame();
          })
          .catch((err) => {
            console.error(err);
            alert("ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯");
            initGame();
          });
      }

      // å•Ÿå‹•
      initGame();
    </script>
  </body>
</html>

