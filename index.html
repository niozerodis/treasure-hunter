<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç¾é£Ÿçµäºº - è¸©åœ°é›·å¤§æŒ‘æˆ°</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        text-align: center;
        background-color: #f0f2f5;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
      }
      h1 {
        color: #333;
        margin-bottom: 10px;
      }
      #score-board {
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 20px;
      }

      /* éŠæˆ²å€åŸŸ */
      #game-grid {
        display: grid;
        grid-template-columns: repeat(5, 60px);
        gap: 10px;
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .box {
        width: 60px;
        height: 60px;
        /* é€™è£¡æŠŠåŸæœ¬çš„ background-image æ‹¿æ‰ï¼Œæ”¹ç”± JS æ§åˆ¶ */
        background-color: #eee; /* é è¨­åº•è‰²ï¼Œåœ–ç‰‡è¼‰å…¥å‰é¡¯ç¤º */
        background-size: cover;
        background-position: center;
        border-radius: 8px;
        cursor: pointer;
        font-size: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.1s;
        user-select: none;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
      }

      .box:active {
        transform: scale(0.95);
      }
      .box.revealed {
        cursor: default;
        pointer-events: none;
        background-image: none !important; /* é‡è¦ï¼å¼·åˆ¶ç§»é™¤èƒŒæ™¯åœ– */
        background-color: #fff; /* é»é–‹å¾Œçš„åº•è‰² */
        box-shadow: none;
      }
      .box.good {
        background-color: #26a6d5;
        color: white;
      }
      .box.good span {
        font-size: 30px;
      }
      .box.bad {
        background-color: #e74c3c;
        animation: shake 0.5s;
        font-size: 30px;
      }

      /* çµç®—å½ˆçª— */
      #modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        width: 300px;
      }
      input {
        padding: 10px;
        width: 80%;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      button {
        padding: 10px 20px;
        background: #333;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background: #555;
      }
      .loading {
        color: #888;
        font-size: 0.9em;
        display: none;
      }

      @keyframes shake {
        0% {
          transform: translate(1px, 1px) rotate(0deg);
        }
        10% {
          transform: translate(-1px, -2px) rotate(-1deg);
        }
        20% {
          transform: translate(-3px, 0px) rotate(1deg);
        }
        30% {
          transform: translate(3px, 2px) rotate(0deg);
        }
        100% {
          transform: translate(0, 0) rotate(0);
        }
      }
    </style>
  </head>
  <body>
    <h1>ç¾é£Ÿçµäºº ğŸ—</h1>
    <div id="score-board">åˆ†æ•¸: 0</div>

    <div id="game-grid"></div>

    <div id="modal">
      <div class="modal-content">
        <h2 id="end-title">ğŸ¤® é£Ÿç‰©ä¸­æ¯’äº†ï¼</h2>
        <p>æœ€çµ‚åˆ†æ•¸: <span id="final-score">0</span></p>
        <input
          type="text"
          id="player-name"
          placeholder="è¼¸å…¥ä½ çš„åå­—"
          maxlength="10"
        />
        <br />
        <button onclick="submitScore()">ä¸Šå‚³åˆ†æ•¸ä¸¦é‡ä¾†</button>
        <p class="loading" id="loading-msg">ä¸Šå‚³ä¸­...</p>
      </div>
    </div>

    <script>
      // è¨­å®šå€ï¼šè«‹å¡«å…¥ä½ çš„ Google Apps Script ç¶²å€
      const API_URL = "https://script.google.com/macros/s/AKfycbx8EG2kN-I28uHcuKZl-UGP9oDEaDf_zejQEW4_m8WxsEtXwJbpWq6SSRHiORuVXVaffg/exec";

      const gridSize = 25; // 5x5
      let score = 0;
      let isGameOver = false;
      let bombIndex = -1;
      const gridEl = document.getElementById("game-grid");
      const scoreEl = document.getElementById("score-board");
      const modalEl = document.getElementById("modal");
      const finalScoreEl = document.getElementById("final-score");

      // åˆå§‹åŒ–éŠæˆ²
      const foodImages = [
          "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=300", // 1. æ¼¢å ¡
          "https://images.unsplash.com/photo-1513104890138-7c749659a591?w=300", // 2. æŠ«è–©
          "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=300", // 3. å£½å¸
          "https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=300", // 4. æ‹‰éºµ
          "https://images.unsplash.com/photo-1600891964092-4316c288032e?w=300", // 5. ç‰›æ’
          "https://images.unsplash.com/photo-1551024709-8f23befc6f87?w=300", // 6. ç”œç”œåœˆ (å·²ä¿®å¾©)
          "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=300", // 7. ç‚¸é›
          "https://images.unsplash.com/photo-1506084868230-bb9d95c24759?w=300", // 8. é¬†é¤… 
          "https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?w=300", // 9. å¡”å¯é¤…
          "https://images.unsplash.com/photo-1473093226795-af9932fe5856?w=300", // 10. ç¾©å¤§åˆ©éºµ
          "https://images.unsplash.com/photo-1563805042-7684c019e1cb?w=300", // 11. å†°æ·‡æ·‹ 
          "https://images.unsplash.com/photo-1496116218417-1a781b1c416c?w=300", // 12. é¤ƒå­
          "https://images.unsplash.com/photo-1565557623262-b51c2513a641?w=300", // 13. å’–å“©é£¯
          "https://images.unsplash.com/photo-1630384060421-cb20d0e0649d?w=300", // 14. è–¯æ¢
          "https://images.unsplash.com/photo-1528735602780-2552fd46c7af?w=300", // 15. ä¸‰æ˜æ²» (å·²ä¿®å¾©)
          "https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=300", // 16. è‰è“è›‹ç³• (æ–°!)
          "https://images.unsplash.com/photo-1578985545062-69928b1d9587?w=300", // 17. å·§å…‹åŠ›è›‹ç³•
          "https://images.unsplash.com/photo-1558326567-98ae2405596b?w=300", // 18. é¦¬å¡é¾ 
          "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=300", // 19. å’–å•¡
          "https://images.unsplash.com/photo-1503764654157-72d979d9af2f?w=300", // 20. è¶Šå—æ²³ç²‰ (å·²ä¿®å¾©)
          "https://images.unsplash.com/photo-1529042410759-befb1204b468?w=300", // 21. çƒ¤è‚‰ä¸²
          "https://images.unsplash.com/photo-1603046891726-36bfd957e0bf?w=300", // 22. é…ªæ¢¨åå¸ (å·²ä¿®å¾©)
          "https://images.unsplash.com/photo-1490474418585-ba9bad8fd0ea?w=300", // 23. æ°´æœå„ªæ ¼ç¢—
          "https://images.unsplash.com/photo-1555507036-ab1f4038808a?w=300", // 24. å¯é Œ
          "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300"  // 25. æ²™æ‹‰
      ];
      
      function initGame() {
          gridEl.innerHTML = '';
          score = 0;
          isGameOver = false;
          scoreEl.innerText = `åˆ†æ•¸: ${score}`;
          modalEl.style.display = 'none';
          document.getElementById('loading-msg').style.display = 'none';
      
          // éš¨æ©Ÿæ±ºå®šç‚¸å½ˆä½ç½® (0 ~ 24)
          bombIndex = Math.floor(Math.random() * gridSize);
          
          // --- é—œéµæ­¥é©Ÿï¼šæ´—ç‰Œ (Shuffle) ---
          // è¤‡è£½ä¸€ä»½åœ–ç‰‡é™£åˆ—ï¼Œä»¥å…å½±éŸ¿åŸå§‹è³‡æ–™
          let shuffledImages = [...foodImages]; 
          // ä½¿ç”¨ sort + random é€²è¡Œç°¡å–®æ´—ç‰Œï¼Œç¢ºä¿æ¯æ¬¡é †åºä¸åŒ
          shuffledImages.sort(() => Math.random() - 0.5);
      
          for (let i = 0; i < gridSize; i++) {
              let box = document.createElement('div');
              box.className = 'box';
              box.dataset.index = i;
              
              // ä¾åºå–å‡ºæ´—ç‰Œå¾Œçš„åœ–ç‰‡
              // ç‚ºäº†é¿å…åœ–ç‰‡å°‘æ–¼æ ¼å­æ•¸å ±éŒ¯ï¼Œä½¿ç”¨ % å–é¤˜æ•¸ (é›–ç„¶é€™è£¡å‰›å¥½éƒ½æ˜¯25)
              let imgUrl = shuffledImages[i % shuffledImages.length];
              box.style.backgroundImage = `url('${imgUrl}')`;
      
              box.addEventListener('click', () => handleClick(box, i));
              gridEl.appendChild(box);
          }
      }

      // é»æ“Šè™•ç†
      function handleClick(box, index) {
        if (isGameOver || box.classList.contains("revealed")) return;

        box.classList.add("revealed");

        if (index === bombIndex) {
          // è¸©åˆ°ç‚¸å½ˆ
          box.classList.add("bad");
          box.innerText = "ğŸ’£";
          gameOver();
        } else {
          // è¸©åˆ°å¯¶è—
          box.classList.add("good");
          box.innerHTML = `<span>ğŸ—</span>å¥½åƒ`
          score += 10;
          scoreEl.innerText = `åˆ†æ•¸: ${score}`;
        }
      }

      function gameOver() {
        isGameOver = true;
        // é¡¯ç¤ºæ‰€æœ‰ç­”æ¡ˆ
        const boxes = document.querySelectorAll(".box");
        boxes[bombIndex].classList.add("bad");
        boxes[bombIndex].innerText = "ğŸ’£";

        setTimeout(() => {
          finalScoreEl.innerText = score;
          modalEl.style.display = "flex";
        }, 500);
      }

      // ä¸Šå‚³åˆ†æ•¸
      function submitScore() {
        const name = document.getElementById("player-name").value || "ç„¡åæ°";
        const loadingMsg = document.getElementById("loading-msg");

        loadingMsg.style.display = "block";

        // ä½¿ç”¨ fetch ç™¼é€ POST è«‹æ±‚
        // mode: 'no-cors' æ˜¯ç‚ºäº†é¿å…è·¨åŸŸéŒ¯èª¤ï¼Œé›–ç„¶é€™æ¨£å‰ç«¯ç„¡æ³•è®€å–å›å‚³å€¼ï¼Œ
        // ä½†è³‡æ–™ç¢ºå¯¦æœƒé€åˆ° Google Sheet
        fetch(API_URL, {
          method: "POST",
          mode: "no-cors",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ name: name, score: score }),
        })
          .then(() => {
            alert("åˆ†æ•¸å·²ä¸Šå‚³ï¼");
            initGame();
          })
          .catch((err) => {
            console.error(err);
            alert("ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯");
            initGame();
          });
      }

      // å•Ÿå‹•
      initGame();
    </script>
  </body>
</html>











